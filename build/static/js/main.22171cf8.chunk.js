(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){"use strict";n.r(e);var s=n(1),a=n(2),o=n(4),i=n(3),r=n(5),l=n(0),c=n.n(l),u=n(7),d=n.n(u),h=(n(14),function(t){function e(){return Object(s.a)(this,e),Object(o.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(r.a)(e,t),Object(a.a)(e,[{key:"render",value:function(){return this.generateHTML(this.props.text,this.props.spans)}},{key:"generateHTML",value:function(t,e){for(var n=this,s=[],a=0,o=function(o){var i=e[o],r=i.label,l=i.start,u=i.end;r=r.toUpperCase();var d=t.slice(l,u),h=t.slice(a,l).split("\n");h.forEach(function(t,e){s.push(t),h.length>1&&e!==h.length-1&&s.push(c.a.createElement("br",null))});var p=n.intToHSL(n.hashCode(r)),g=!1;s.push(c.a.createElement("span",{"data-entity":r,style:{background:p},onClick:function(t){if(g)return g=!1,!1;n.props.cycleSpanLabel(o)}},d,c.a.createElement("button",{onClick:function(t){g=!0,n.props.deleteSpan(o)}},"x"))),a=u},i=0;i<e.length;i++)o(i);var r=t.slice(a,t.length).split("\n");return r.forEach(function(t,e){s.push(t),r.length>1&&e!==r.length-1&&s.push(c.a.createElement("br",null))}),s}},{key:"hashCode",value:function(t){for(var e=0,n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);return e-100*t.length}},{key:"intToHSL",value:function(t){return"hsla("+(t-400)%360+", 90%, 65%, 1)"}}]),e}(c.a.Component)),p=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(o.a)(this,Object(i.a)(e).call(this,t))).state={text:t.text||"No Text Given",ents:t.avalableEnts||["PRODUCT","ORG","GPE","LOC","MONEY","TIME","PERCENT","DATE","QUANTITY","ORDINAL","CARDINAL","PERSON","NORP","FAC"],lastEnt:null,undoHistory:[{spans:t.spansObj||[]}]},n}return Object(r.a)(e,t),Object(a.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState({text:t.text||"No Text Given",ents:t.ents||this.state.ents,undoHistory:[{spans:t.spansObj||[]}]})}},{key:"render",value:function(){var t=this,e=this.state.undoHistory,n=e[e.length-1];return console.log(e),c.a.createElement("figure",{id:"displacy_container",onMouseUp:function(e){t.handleMouseUp(e)}},c.a.createElement(h,{text:this.state.text,ents:this.state.ents,spans:n.spans,deleteSpan:this.deleteSpan.bind(this),cycleSpanLabel:this.cycleSpanLabel.bind(this)}))}},{key:"undo",value:function(){if(console.log("undoing"),this.state.undoHistory.length<=1)return!1;this.setState({undoHistory:this.state.undoHistory.slice(0,this.state.undoHistory.length-1)})}},{key:"deleteSpan",value:function(t){var e=this.state.undoHistory,n=e[e.length-1].spans.slice();n.splice(t,1),this.setState({undoHistory:e.concat([{spans:n}])})}},{key:"cycleSpanLabel",value:function(t){var e=this.state.undoHistory,n=e[e.length-1].spans.slice();n[t]={start:n[t].start,end:n[t].end,label:this.state.ents[(this.state.ents.indexOf(n[t].label)+1)%this.state.ents.length]},this.setState({undoHistory:e.concat([{spans:n}])})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyPress.bind(this),!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyPress.bind(this),!1)}},{key:"handleKeyPress",value:function(t){console.log(t),"z"!==t.key||!0!==t.ctrlKey&&!0!==t.metaKey||this.undo()}},{key:"handleMouseUp",value:function(t){var e=this.state.undoHistory,n=e[e.length-1].spans.slice();if((a=this.getSelectionRange()).start===a.end)return!1;var s=this.findSpansOverlapingSelection(n,a),a=(n=s.spans,s.selection);console.log("selection: "+this.state.text.slice(a.start,a.end),a),a.label=this.state.ents[0],console.log(n,a);for(var o=0;n[o]&&n[o].end<a.start;)o++;o>=n.length?n.push(a):n.splice(o,0,a),this.setState({undoHistory:e.concat([{spans:n}])})}},{key:"findSpansOverlapingSelection",value:function(t,e){for(var n=0;n<t.length;n++){var s=t[n];e.start<=s.end&&s.end<=e.end&&e.start<=s.start&&s.start<=e.end?(console.log("splicing",t[n]),t.splice(n,1),n--):e.start<=s.start&&s.start<=e.end?(console.log("trimming end to: "+(s.end+1),t[n]),e.end=s.start):e.start<=s.end&&s.end<=e.end?(console.log("trimming start to: "+(s.end+1),t[n]),e.start=s.end):console.log("not splicing",t[n])}return{spans:t,selection:e}}},{key:"getSelectionRange",value:function(){var t=window.getSelection();if(0===t.rangeCount)return{start:0,end:0};var e=t.getRangeAt(0);console.log(e);var n=t.getRangeAt(t.rangeCount-1);console.log(n);var s=0,a=0,o=0;return document.getElementById("displacy_container").childNodes.forEach(function(t){t!==e.startContainer&&t!==e.startContainer.parentNode||(s=o+e.startOffset),t!==n.endContainer&&t!==n.endContainer.parentNode?("BR"===t.nodeName?(o+=1,console.log("here")):1===t.nodeType&&t.hasAttribute("data-entity")&&(o-=1),o+=t.textContent.length):a=o+n.endOffset}),t.removeAllRanges(),{start:s,end:a}}}]),e}(c.a.Component),g=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(o.a)(this,Object(i.a)(e).call(this,t))).state={text:"Loading...",spans:[],databaseId:null},n}return Object(r.a)(e,t),Object(a.a)(e,[{key:"componentDidMount",value:function(){this.getNext()}},{key:"getNext",value:function(){var t=this;fetch("http://127.0.0.1:8080/next").then(function(t){return t.json()}).then(function(e){var n=e;console.log(n),t.setState({text:n.text||"error",spans:n.ents||[],databaseId:n.database_id||""})})}},{key:"render",value:function(){return c.a.createElement("div",{className:"App"},c.a.createElement(p,{text:this.state.text,spansObj:this.state.spans}))}}]),e}(c.a.Component),f=document.getElementById("root");d.a.render(c.a.createElement(g,null),f)},8:function(t,e,n){t.exports=n(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.22171cf8.chunk.js.map