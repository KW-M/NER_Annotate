(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n(2),r=n(4),i=n(3),o=n(5),l=n(0),c=n.n(l),u=n(7),h=n.n(u),p=(n(14),function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return this.generateHTML(this.props.text,this.props.spans)}},{key:"generateHTML",value:function(e,t){for(var n=this,a=[],s=0,r=function(r){var i=t[r],o=i.label,l=i.start,u=i.end;o=o.toUpperCase();var h=e.slice(l,u),p=e.slice(s,l).split("\n");p.forEach(function(e,t){a.push(e),p.length>1&&t!==p.length-1&&a.push(c.a.createElement("br",null))});var d=n.intToHSL(n.hashCode(o)),f=!1;a.push(c.a.createElement("span",{"data-entity":o,style:{background:d},onClick:function(e){if(f)return f=!1,!1;n.props.cycleSpanLabel(r)}},h,c.a.createElement("button",{onClick:function(e){f=!0,n.props.deleteSpan(r)}},"x"))),s=u},i=0;i<t.length;i++)r(i);var o=e.slice(s,e.length).split("\n");return o.forEach(function(e,t){a.push(e),o.length>1&&t!==o.length-1&&a.push(c.a.createElement("br",null))}),a}},{key:"hashCode",value:function(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t-100*e.length}},{key:"intToHSL",value:function(e){return"hsla("+(e-400)%360+", 90%, 65%, 1)"}}]),t}(c.a.Component)),d=function(e){function t(){return Object(a.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.state.undoHistory,n=t[t.length-1];return console.log(t),c.a.createElement("figure",{id:"displacy_container",onMouseUp:function(t){e.handleMouseUp(t)}},c.a.createElement(p,{text:this.state.text,ents:this.state.ents,spans:n.spans,deleteSpan:this.deleteSpan.bind(this),cycleSpanLabel:this.cycleSpanLabel.bind(this)}))}},{key:"deleteSpan",value:function(e){var t=this.state.undoHistory,n=t[t.length-1].spans.slice();n.splice(e,1),this.props.updateSpans(n)}},{key:"cycleSpanLabel",value:function(e){var t=this.state.undoHistory,n=t[t.length-1].spans.slice();n[e]={start:n[e].start,end:n[e].end,label:this.state.ents[(this.state.ents.indexOf(n[e].label)+1)%this.state.ents.length]},this.setState({undoHistory:t.concat([{spans:n}])})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyPress.bind(this),!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyPress.bind(this),!1)}},{key:"handleKeyPress",value:function(e){console.log(e)}},{key:"handleMouseUp",value:function(e){var t=this.state.undoHistory,n=t[t.length-1].spans.slice();if((s=this.getSelectionRange()).start===s.end)return!1;var a=this.findSpansOverlapingSelection(n,s),s=(n=a.spans,a.selection);console.log("selection: "+this.state.text.slice(s.start,s.end),s),s.label=this.state.ents[0],console.log(n,s);for(var r=0;n[r]&&n[r].end<s.start;)r++;r>=n.length?n.push(s):n.splice(r,0,s),this.setState({undoHistory:t.concat([{spans:n}])})}},{key:"findSpansOverlapingSelection",value:function(e,t){for(var n=0;n<e.length;n++){var a=e[n];t.start<=a.end&&a.end<=t.end&&t.start<=a.start&&a.start<=t.end?(console.log("splicing",e[n]),e.splice(n,1),n--):t.start<=a.start&&a.start<=t.end?(console.log("trimming end to: "+(a.end+1),e[n]),t.end=a.start):t.start<=a.end&&a.end<=t.end?(console.log("trimming start to: "+(a.end+1),e[n]),t.start=a.end):console.log("not splicing",e[n])}return{spans:e,selection:t}}},{key:"getSelectionRange",value:function(){var e=window.getSelection();if(0===e.rangeCount)return{start:0,end:0};var t=e.getRangeAt(0);console.log(t);var n=e.getRangeAt(e.rangeCount-1);console.log(n);var a=0,s=0,r=0;return document.getElementById("displacy_container").childNodes.forEach(function(e){e!==t.startContainer&&e!==t.startContainer.parentNode||(a=r+t.startOffset),e!==n.endContainer&&e!==n.endContainer.parentNode?("BR"===e.nodeName?(r+=1,console.log("here")):1===e.nodeType&&e.hasAttribute("data-entity")&&(r-=1),r+=e.textContent.length):s=r+n.endOffset}),e.removeAllRanges(),{start:a,end:s}}}]),t}(c.a.Component),f=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,e))).state={currentlyFetching:!1,avalableEntities:[],currentExampleHistoryIndex:0,exampleHistory:[]},n}return Object(o.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.fetchAvalableEntities(),this.showNextExample()}},{key:"showNextExample",value:function(){var e=this;if(!0!==this.state.currentlyFetching){var t=this.state.exampleHistory,n=this.state.currentExampleHistoryIndex;n<t.length-1?this.setState({currentExampleHistoryIndex:n+1}):(this.setState({currentlyFetching:!0}),this.fetchNextExample().then(function(n){console.log(n),n.undoHistory=[{spans:n.ents}],delete n.ents;var a=t.concat([n]);e.setState({currentlyFetching:!1,exampleHistory:a,currentExampleHistoryIndex:a.length-1})}))}}},{key:"showPrevExample",value:function(){var e=this.state.currentExampleHistoryIndex;e>0&&this.setState({currentExampleHistoryIndex:e-1})}},{key:"fetchNextExample",value:function(){return fetch("/next").then(function(e){return e.json()})}},{key:"saveSpans",value:function(){}},{key:"fetchAvalableEntities",value:function(){var e=this;fetch("/avalable_ents").then(function(e){return e.json()}).then(function(t){var n=t;console.log(n),e.setState({avalableEntities:n})})}},{key:"render",value:function(){var e=this.state.exampleHistory[this.state.currentExampleHistoryIndex],t=null;if(this.state.currentlyFetching&&(t=c.a.createElement("progress",null)),void 0!==e){var n=e.undoHistory,a=n[n.length-1];return c.a.createElement("div",{className:"App"},t,c.a.createElement(d,{text:e.text,spans:a.spans,avalableEntities:this.state.avalableEntities}))}return"Loading..."}}]),t}(c.a.Component),v=document.getElementById("root");h.a.render(c.a.createElement(f,null),v)},8:function(e,t,n){e.exports=n(15)}},[[8,1,2]]]);
//# sourceMappingURL=main.65819aa4.chunk.js.map